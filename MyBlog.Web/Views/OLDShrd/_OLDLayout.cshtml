@using Microsoft.AspNetCore.Authorization
@inject IAuthorizationService authService

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <base href="~/" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/site.css" />

    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script src="~/lib/jquery/dist/jquery.pjax.js"></script>


    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>



    <title>@ViewBag.Title</title>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <div class="navbar-nav me-auto mb-2 mb-lg-0">
                <button id="mainAllPostsBtn" class="btn btn-outline-primary me-2 js-nav-btn">Home</button>
                @if (User.Identity != null && User.Identity.IsAuthenticated)
                {
                    @if ((await authService.AuthorizeAsync(User, "AdminPolicy")).Succeeded)
                    {
                        <button class="btn btn-outline-primary me-2 js-nav-btn" @*asp-controller="Admin" asp-action="Index"*@>Admin</button>
                    }
                    <button id="userBtn" class="btn btn-outline-primary me-2 js-nav-btn">@User.Identity.Name</button>
                }

                <input id="mainSearch" class="form-control me-2" type="search" placeholder="Posts" aria-label="Search">
                <input id="usersSearch" class="form-control me-2" type="search" placeholder="Users" aria-label="Search">

            </div>
            <div class="navbar-nav ms-auto mb-2 mb-lg-0">
                @if (User.Identity != null && User.Identity.IsAuthenticated)
                {
                    <a class="btn btn-primary" asp-controller="Accounts" asp-action="Logout">Log out</a>
                }
                else
                {
                    @*<a class="nav-link active" asp-controller="Accounts" asp-action="Login">Log in</a>*@
                    <!-- Login modal -->
                    <button id="loginModalBtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">
                        Log in
                    </button>
                }
            </div>
        </div>
    </nav>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    </div>

    <div class="container" id="mainInLayout">
    </div>

    <div>
        @RenderBody()
    </div>


    <script src="~/js/account.js"></script>

    <script src="~/js/admin.js"></script>

    <script src="~/js/mainSearch.js"></script>

    <script src="~/js/commentLayout.js"></script>

    <script src="~/js/userLayout.js"></script>
    <script src="~/js/usersSearch.js"></script>
    <script src="~/js/usersPagination.js"></script>

    <script src="~/js/postLayout.js"></script>
    <script src="~/js/createPost.js"></script>
    <script src="~/js/editPost.js"></script>
    <script src="~/js/postsPagination.js"></script>

    <script src="~/js/avatar.js"></script>

    <script src="~/js/history.js"></script>

    <script>
        $('#loginModal').load("Accounts/Login")

        $('#mainInLayout').load("Post/AllPosts")

        $('#mainAllPostsBtn').on('click', function (e) {
            history.replaceState(null, null, ' ');
            history.pushState(null, null, 'Home');
            $('#mainInLayout').load("Post/AllPosts")
        });
    </script>


    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
